<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>IrisCTF 2024 - [The Maze] - Rev :: L3ak CTF</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Writeup for The Maze from IrisCTF 2024. " />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://l3ak.team/posts/irisctf/" />






  
  
  
  
  
  <link rel="stylesheet" href="https://l3ak.team/styles.css">







  <link rel="shortcut icon" href="https://l3ak.team/icon.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="IrisCTF 2024 - [The Maze] - Rev">
<meta property="og:description" content="Writeup for The Maze from IrisCTF 2024. " />
<meta property="og:url" content="https://l3ak.team/posts/irisctf/" />
<meta property="og:site_name" content="L3ak CTF" />

  
    <meta property="og:image" content="https://l3ak.team/icon.png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2024-01-08 00:00:00 &#43;0000 UTC" />












</head>
<body class="green">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/home">
  <div class="logo">
    [root@L3ak:~]# 
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/home">Home</a></li>
        
      
        
          <li><a href="/members">Members</a></li>
        
      
        
          <li><a href="/posts">Write-ups</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/home" >Home</a></li>
        
      
        
          <li><a href="/members" >Members</a></li>
        
      
        
          <li><a href="/posts" >Write-ups</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://l3ak.team/posts/irisctf/">IrisCTF 2024 - [The Maze] - Rev</a>
  </h1>
  <div class="post-meta"><time class="post-date">2024-01-08</time><span class="post-author">Bluegale</span></div>

  
  


  

  <div class="post-content"><div>
        <h1 id="irisctf-2024https2024irisctf"><a href="https://2024.irisc.tf/">irisctf-2024</a><a href="#irisctf-2024https2024irisctf" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h2 id="the-maze">The Maze<a href="#the-maze" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><strong>Category: reverse</strong></p>
<h2 id="description">Description<a href="#description" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>The challenge is a maze played in the browser.</p>
<p><img src="image.png" alt="Alt text"></p>
<p>After deobfucating the inital string we get a few functions.
f is used to generate a new map with the seed as the parameter.</p>
<p>From the code we get the following interesting parts</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">n</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Dugd8DbBCXnrEF1kKd2Hg4lsRQ1eV/6gQ+NfwsVhtr4UgeXQFq1m6WctmIljEG7PZg==&#34;</span>

<span style="color:#ae81ff">4</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">b</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">some</span>((<span style="color:#a6e22e">e</span>=&gt;<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">e</span>)) <span style="color:#f92672">||</span> <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">e</span>) {
                  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">e</span>=&gt;<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">toString</span>(<span style="color:#ae81ff">16</span>).<span style="color:#a6e22e">padStart</span>(<span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#34;0&#34;</span>))).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;&#34;</span>)
                    , <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Uint8Array</span>(<span style="color:#a6e22e">atob</span>(<span style="color:#a6e22e">e</span>).<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;&#34;</span>).<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">e</span>=&gt;<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">charCodeAt</span>(<span style="color:#ae81ff">0</span>))))
                    , <span style="color:#a6e22e">n</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Uint8Array</span>.<span style="color:#a6e22e">from</span>([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>])
                    , <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TextEncoder</span>).<span style="color:#a6e22e">encode</span>(<span style="color:#a6e22e">t</span>)
                    , <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">crypto</span>.<span style="color:#a6e22e">subtle</span>.<span style="color:#a6e22e">importKey</span>(<span style="color:#e6db74">&#34;raw&#34;</span>, <span style="color:#a6e22e">r</span>, {
                      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;AES-GCM&#34;</span>
                  }, <span style="color:#f92672">!</span><span style="color:#ae81ff">1</span>, [<span style="color:#e6db74">&#34;decrypt&#34;</span>])
                    , <span style="color:#a6e22e">o</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">crypto</span>.<span style="color:#a6e22e">subtle</span>.<span style="color:#a6e22e">decrypt</span>({
                      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;AES-GCM&#34;</span>,
                      <span style="color:#a6e22e">iv</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">n</span>
                  }, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">a</span>);
                  <span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TextDecoder</span>).<span style="color:#a6e22e">decode</span>(<span style="color:#a6e22e">o</span>)
              }(<span style="color:#a6e22e">n</span>)
</code></pre></div><p>So the flag gets decrypted if i.b is 4 and no element in i.e is -1
i.e gets filled in the following code</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">push</span>(<span style="color:#e6db74">&#34;1,6,11,16&#34;</span> <span style="color:#f92672">==</span> (<span style="color:#a6e22e">e</span> <span style="color:#f92672">=</span> [...Array(<span style="color:#ae81ff">4</span>).<span style="color:#a6e22e">keys</span>()].<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">e</span>=&gt;<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">e</span>, <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">e</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>))),
              <span style="color:#a6e22e">t</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">a</span>[<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">b</span>],
              <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">e</span>=&gt;<span style="color:#a6e22e">t</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">map</span>(((<span style="color:#a6e22e">e</span>,<span style="color:#a6e22e">a</span>)=&gt;<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">e</span>=&gt;<span style="color:#a6e22e">e</span>[<span style="color:#a6e22e">a</span>])))).<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">t</span>=&gt;<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">map</span>(((<span style="color:#a6e22e">a</span>,<span style="color:#a6e22e">n</span>)=&gt;<span style="color:#a6e22e">e</span>[<span style="color:#a6e22e">n</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">t</span>[<span style="color:#a6e22e">n</span>])).<span style="color:#a6e22e">reduce</span>(((<span style="color:#a6e22e">e</span>,<span style="color:#a6e22e">t</span>)=&gt;<span style="color:#a6e22e">e</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span>))))))).<span style="color:#a6e22e">flatMap</span>((<span style="color:#a6e22e">e</span>=&gt;<span style="color:#a6e22e">e</span>)).<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">e</span>=&gt;Math.<span style="color:#a6e22e">round</span>(<span style="color:#ae81ff">100</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">e</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>)).<span style="color:#a6e22e">map</span>(((<span style="color:#a6e22e">e</span>,<span style="color:#a6e22e">t</span>)=&gt;<span style="color:#ae81ff">1</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">e</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">e</span>)).<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">e</span>=&gt;<span style="color:#a6e22e">e</span>)) <span style="color:#f92672">?</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">k</span> <span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</code></pre></div><p>So it is checking for some numbers in i.i which turn out to be our moves on the maze.
However we cant just force it to take i.k since i.k also changes depending on our moves:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">k</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">k</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">211</span> <span style="color:#f92672">*</span> (<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">9</span>) <span style="color:#f92672">*</span> (<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">9</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">239</span> <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">4294967295</span>,
</code></pre></div><p>Extracting the code that is checking i.i the file find_numers.js is created.
The log is speratable into 4 parts and these 4 parts have to be brutefoced individually.
This also has to be done for all the 4 levels.
This is the result for level0</p>
<pre tabindex="0"><code>result_level0 =
    [
        -19, -29, -29,  -6, 
        -14,  22, 13,  15,  
        18,  16, -13, -12, 
        22,  27,  12, -22,
    ]
</code></pre><p>These numebers map to a specific combination of moves. And calculating the above mentioned i.k at every step gives the following keys:
(done in calculate_moves.js)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">[<span style="color:#ae81ff">40645774</span>,
<span style="color:#ae81ff">130661539</span>,
<span style="color:#ae81ff">116339703</span>,
<span style="color:#ae81ff">150379278</span>]
</code></pre></div><p>Now the only thing left is to decode the flag in decode.js</p>

      </div></div>

  
    
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://l3ak.team/posts/uoftctf/">
                <span class="button__icon">←</span>
                <span class="button__text">UofTCTF - [zero] - Misc</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://l3ak.team/posts/tcp1pctf/">
                <span class="button__text">TCP1PCTF 2023 - [Invitation] - Blockchain</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>⛳</span>
    
      <span>L3ak 2024</span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
